<!--
# Copyright (c) 2021 - 2022 Advanced Micro Devices, Inc. All rights reserved.
#
#-------------------------------------------------------------------------------------------------
-->
<!DOCTYPE html>
<html>
<body>
    <h1 id="background">Background</h1>
    <p>User may encounter a situation where they cannot directly use ADLX functionalities in windows service application.</p>
    <p>This documentation demonstrates how to call ADLX functionalities in windows service call.</p>
    <p>We have the sample codes in “ADLX/Samples/CPP/ServiceCall/GPUService” as CPP project or “ADLX/Samples/C/ServiceCall/GPUService” as C project. They both generate executable “GPUService.exe”.</p>
    <h1 id="usage">Usage</h1>
    <p>This executable is run as service (if you run it as a normal application it will abort with errors)</p>
    <h2 id="install-this-service">Install this service</h2>
    <ol type="1">
        <li><p>Open windows command line utility with administrator permission. Switch directory to the executable’s path, take my dev PC for example:</p>
        </li>
    </ol>
    <blockquote>
    <p>“D:/DevShared3/Work/Repo/drivers/drivers/ADLX/Samples/CPP/build/bin/Debug/”</p>
    </blockquote>
    <ol start="2" type="1">
        <li><p>Copy “ADLX.dll”(ADLX library binary) in this folder, then enter “GPUService.exe -install:</p></li>
    </ol>
    <blockquote>
    <p><img src="media/image1.png" style="width:5.76806in;height:3.15in" alt="Text Description automatically generated" /></p>
    </blockquote>
    <ol start="3" type="1">
        <li><p>Check if the service is installed:</p></li>
    </ol>
    <blockquote>
    <p>Open windows’ service settings by win+R with services.msc:</p>
    <p><img src="media/image2.png" style="width:3.07557in;height:1.78705in" alt="Graphical user interface, text, application Description automatically generated" /></p>
    <p>Check service with name “ADLX GPU Service”</p>
    <p><img src="media/image3.png" style="width:5.15972in;height:3.05105in" /></p>
    </blockquote>
    <h2 id="uninstall-adlx-gpu-service">Uninstall “ADLX GPU Service”</h2>
    <p>Open windows command line utility with administrator permission, enter “GPUService.exe -remove”</p>
    <p><img src="media/image4.png" style="width:5.76389in;height:0.65278in" /></p>
    <p>The service is removed in OS.</p>
    <h2 id="debug-this-service">Debug this service</h2>
    <ol type="1">
        <li><p>Start the service:</p></li>
    </ol>
    <p><img src="media/image5.png" style="width:5.76806in;height:2.38264in" alt="Graphical user interface, application Description automatically generated" /></p>
    <ol start="2" type="1">
        <li><p>Run the debugging executable (compiled with debug configuration)</p></li>
    </ol>
    <p>Open Dbgview.exe (visual studio contains it by default) with administrator mode to view the output of this service. By default, the service runs a worker thread in backgound to output GPU vendor id and name periodically with 3 seconds.</p>
    <ol start="3" type="1">
        <li><p>Set Dbgview.exe (admin mode) with below options:</p></li>
    </ol>
    <p><img src="media/image6.png" style="width:5.76806in;height:2.96111in" alt="Graphical user interface, text, application, email Description automatically generated" /></p>
    <ol start="4" type="1">
        <li><p>Check the service outputs (with “ADLX Call Service:”prefix):</p></li>
    </ol>
    <p><img src="media/image7.png" style="width:5.76597in;height:1.89583in" /></p>
</body>
</html>